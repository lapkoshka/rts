<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>RTS</title>
        <link rel="stylesheet" type="text/css" href="./view/styles/base.css">
        <link rel="stylesheet" type="text/css" href="./view/styles/ui.css">

        <link rel="stylesheet" type="text/css" href="./view/styles/smartbanner.css">
        <link rel="stylesheet" type="text/css" href="./view/styles/race.css">

        <link rel="stylesheet" type="text/css" href="./view/styles/results/results.css">
        <link rel="stylesheet" type="text/css" href="./view/styles/results/tables.css">

        <link rel="stylesheet" type="text/css" href="./view/styles/rssi.css">

        <link rel="stylesheet" type="text/css" href="./view/styles/reg-fullscreenpopup.css">
    </head>
    <body>
        <div class="content">

            <div id="smarbanner" class="smartbanner ui-block">
                <div class="smartbanner-readers">
                    <div class="smartbanner-reader smartbanner-mainreader">
                        <div class="smartbanner-mainreader-button">
                            <div class="smartbanner-reader-status smartbanner-reader-disabled"></div>
                            <span class="smartbanner-reader-title">Главный считыватель</span>
                        </div>
                    </div>

                    <div class="smartbanner-reader smartbanner-portablereader">
                        <div class="smarbanner-portablereader-button">
                            <div class="smartbanner-reader-status smartbanner-reader-disabled"></div>
                            <span class="smartbanner-reader-title">Портативный считыватель</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="rssi" class="rssi ui-block">
                <div class="rssi-close">Закрыть</div>
                <div id="histogram"></div>
            </div>

            <main>
                <div id="race" class="race ui-block">
                    <table>
                        <tr class="race-header">
                            <th class="race-row-name">Имя</th>
                            <th class="row-row-time">Время</th>
                        </tr>
                    </table>
                </div>

                <div id="results" class="results">
                    <div class="result-tabs">
                        <div id="tab-history" class="result-tab result-tab-selected">История</div>
                        <div id="tab-users" class="result-tab">Участники</div>
                        <div id="tab-total" class="result-tab">Итого</div>
                    </div>
                    <div class="results-view ui-block">

                        <div id="history" class="history">
                            <input class="history-filter-name ui-input" placeholder="Фильтр:Имя">
                            <table>
                                <tr class="history-header">
                                    <th class="history-row-id">N</th>
                                    <th class="history-row-name">Имя</th>
                                    <th class="history-row-time">Время</th>
                                    <th class="history-row-name">Дата</th>
                                </tr>
                            </table>
                        </div>

                        <div id="users" class="users">
                            <table>
                                <tr class="users-header">
                                    <th class="users-row-uid">Имя</th>
                                    <th class="users-row-name">Лучшее время</th>
                                </tr>
                            </table>
                        </div>

                        <div id="total" class="total">
                            <table>
                                <tr class="total-header">
                                    <th class="total-row-name">Имя</th>
                                    <th class="total-row-best-time">Лучшее время</th>
                                    <th class="total-row-best-count">Всего заездов</th>
                                </tr>
                            </table>
                        </div>

                    </div>
                </div>
            </main>

            <div id="regPopup" class="reg-fullscreenpopup">
                <div class="reg-fullscreenpopup-content">
                    <div class="reg-fullscreenpopup-close">Закрыть</div>
                    <h2>Новый участник</h2>
                    <input class="reg-fullscreenpopup-field reg-fullscreenpopup-uid ui-input" type="text" placeholder="Tag">
                    <input class="reg-fullscreenpopup-field reg-fullscreenpopup-firstname ui-input" type="text" placeholder="Имя">
                    <input class="reg-fullscreenpopup-field reg-fullscreenpopup-lastname ui-input" type="text" placeholder="Фамилия">
                    <button class="reg-fullscreenpopup-submit ui-button">Добавить</button>
                    <span class="popup-portablereader-button">Вкл\Откл портативный считыватель</span>
                </div>
            </div>
        </div>
    </body>
    <!-- TEMPORARY DISABLED -->
    <!-- <script src="./view/lib/plotly-latest.min.js"></script> -->
    <script>
         window.commonLib = require('./view/lib/common-lib');
         const { ipcRenderer } = require('electron');

         const smartbannerComponent = require('./view/components/smartbanner');
         const raceComponents = require('./view/components/race');
         const resultsComponent = require('./view/components/results/results');
         const regPopupComponent = require('./view/components/reg-popup');
         const rssiComponent = require('./view/components/rssi');

        const windowDispatcher = {
            sendRendererEvent(type, data) {
                ipcRenderer.send(type, data);
            },
            onRendererEvent(type, listener) {
                ipcRenderer.on(type, listener)
            }
        };

         smartbannerComponent(smarbanner, windowDispatcher);
         raceComponents(race, windowDispatcher);
         resultsComponent(results, windowDispatcher);
         regPopupComponent(regPopup, windowDispatcher);
         rssiComponent(rssi, windowDispatcher);

        window.fakePortableTag = (uid, rssi) =>
            windowDispatcher.sendRendererEvent('fakePortableTag', { uid, rssi });
        window.fakeMainTag = (uid, rssi) =>
            windowDispatcher.sendRendererEvent('fakeMainTag', { uid, rssi});

         document.addEventListener('DOMContentLoaded', () =>
            windowDispatcher.sendRendererEvent('onViewReady'));
    </script>
</html>
