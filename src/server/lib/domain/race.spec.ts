// TODO: add tests for race
